{% extends 'base.html' %}
{% load static %}
{% load price_filters %}

{% block title %}Home - Kaloriz{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/pages/home.css' %}">
{% endblock %}

{% block content %}
<div class="page-home">
  <!-- Hero Banner Section 16:9 -->
  <section class="hero-banner">
    <img src="{% static 'images/banner.jpg' %}" alt="Banner Kaloriz"
         onerror="this.src='https://images.unsplash.com/photo-1472851294608-062f824d29cc?w=1920&h=1080&fit=crop'">

    <div class="hero-banner-overlay">
      <div class="container">
        <div class="row justify-content-center text-center">
          <div class="col-lg-10">
            <h1 class="animate__animated animate__fadeInDown">Selamat Datang di Kaloriz</h1>
            <p class="lead animate__animated animate__fadeInUp">
              Belanja Mudah, Harga Terbaik, Produk Berkualitas
            </p>
            <p class="mb-4">Temukan ribuan produk pilihan dengan harga spesial hanya untuk Anda</p>
            <div class="mt-4">
              <a href="{% url 'catalog:product_list' %}" class="btn btn-light btn-lg mr-3 mb-2">
                <i class="fas fa-shopping-bag"></i> Belanja Sekarang
              </a>
              <a href="{% url 'catalog:about' %}" class="btn btn-outline-light btn-lg mb-2">
                <i class="fas fa-info-circle"></i> Tentang Kami
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- Stats Section -->
<section class="stats-section">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <div class="stat-item">
          <i class="fas fa-box-open"></i>
          <h3>{{ products_count|default:"12" }}+</h3>
          <p>Produk Tersedia</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-item">
          <i class="fas fa-users"></i>
          <h3>1000+</h3>
          <p>Pelanggan Puas</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-item">
          <i class="fas fa-truck"></i>
          <h3>24/7</h3>
          <p>Pengiriman Cepat</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Categories Section -->
{% if categories %}
  <section class="categories-section py-5">
    <div class="container">
      <h2 class="text-center mb-4">Kategori Produk</h2>
      <p class="text-center text-muted mb-5">Jelajahi berbagai kategori produk kami</p>
      <div class="row">
        {% for category in categories %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 hover-shadow category-card">
            <div class="card-body text-center">
              <i class="category-icon fas
                {% if 'elektronik' in category.name|lower %}fa-laptop
              {% elif 'fashion' in category.name|lower %}fa-tshirt
              {% elif 'makanan' in category.name|lower %}fa-utensils
              {% elif 'buku' in category.name|lower %}fa-book
              {% elif 'olahraga' in category.name|lower %}fa-dumbbell
              {% else %}fa-box{% endif %}">
            </i>
            <h5 class="card-title font-weight-bold">{{ category.name }}</h5>
            <p class="card-text text-muted">{{ category.description|truncatewords:10 }}</p>
            <a href="{% url 'catalog:category_detail' category.slug %}" class="btn btn-primary">
              <i class="fas fa-arrow-right"></i> Lihat Produk
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- Featured Products Section -->
<section class="products-section py-5 bg-light">
  <div class="container">
    <h2 class="text-center mb-2">Produk Unggulan</h2>
    <p class="text-center text-muted mb-5">Produk pilihan dengan penawaran terbaik</p>

    {% if featured_products %}
    <div class="row">
      {% for product in featured_products %}
      <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
        <div class="modern-product-card">
          <!-- Discount Badge - Top Left -->
          {% if product.is_on_sale %}
          <div class="discount-badge">
            -{{ product.get_discount_percentage }}%
          </div>
          {% endif %}

          <!-- Wishlist Icon - Top Right -->
          {% if user.is_authenticated %}
          <div class="wishlist-icon" onclick="event.stopPropagation();">
            <form method="post" action="{% url 'core:add_to_watchlist' product.id %}" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="wishlist-btn">
                <i class="fas fa-heart"></i>
              </button>
            </form>
          </div>
          {% endif %}

          <!-- Product Image -->
          <div class="product-image-wrapper" onclick="window.location.href='{% url 'catalog:product_detail' product.slug %}'">
            {% if product.image %}
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
              <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=300&fit=crop" alt="{{ product.name }}" class="product-image">
            {% endif %}
          </div>

          <!-- Product Info -->
          <div class="product-info" onclick="window.location.href='{% url 'catalog:product_detail' product.slug %}'">
            <!-- Star Rating -->
            {{ product|rating_stars }}

            <!-- Product Name -->
            <h3 class="product-name">{{ product.name|truncatewords:4 }}</h3>

            <!-- Price -->
            <div class="product-price">
              {% if product.is_on_sale %}
                <span class="price-original">Rp {{ product.price|dot_separator }}</span>
                <span class="price-sale">Rp {{ product.get_display_price|dot_separator }}</span>
              {% else %}
                <span class="price-sale">Rp {{ product.price|dot_separator }}</span>
              {% endif %}
            </div>
          </div>

          <!-- Add to Cart Button - Bottom Right -->
          {% if user.is_authenticated %}
          <div class="cart-button-wrapper" onclick="event.stopPropagation();">
          <form method="post" action="{% url 'core:add_to_cart' product.id %}" class="d-inline">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="1">
            <button type="submit" class="cart-btn-round" {% if product.stock == 0 %}disabled{% endif %}>
                <i class="fas fa-shopping-cart"></i>
              </button>
            </form>
          </div>
          {% else %}
          <div class="cart-button-wrapper" onclick="event.stopPropagation();">
            <a href="{% url 'core:login' %}?next={{ request.path }}" class="cart-btn-round">
              <i class="fas fa-sign-in-alt"></i>
            </a>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="text-center mt-4">
      <a href="{% url 'catalog:product_list' %}" class="btn btn-lg btn-outline-primary">
        Lihat Semua Produk <i class="fas fa-arrow-right"></i>
      </a>
    </div>
    {% else %}
    <div class="alert alert-info text-center">
      <i class="fas fa-info-circle"></i> Belum ada produk tersedia.
    </div>
    {% endif %}
  </div>
</section>

<!-- Why Choose Us Section -->
<section class="why-us-section py-5">
  <div class="container">
    <h2 class="text-center mb-5">Mengapa Pilih Kaloriz?</h2>
    <div class="row">
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="text-center">
          <div class="mb-3">
            <i class="fas fa-shield-alt fa-3x text-primary"></i>
          </div>
          <h5>Produk Original</h5>
          <p class="text-muted">100% produk original bergaransi</p>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="text-center">
          <div class="mb-3">
            <i class="fas fa-shipping-fast fa-3x text-primary"></i>
          </div>
          <h5>Pengiriman Cepat</h5>
          <p class="text-muted">Pengiriman ke seluruh Indonesia</p>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="text-center">
          <div class="mb-3">
            <i class="fas fa-lock fa-3x text-primary"></i>
          </div>
          <h5>Pembayaran Aman</h5>
          <p class="text-muted">Transaksi dijamin aman</p>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="text-center">
          <div class="mb-3">
            <i class="fas fa-headset fa-3x text-primary"></i>
          </div>
          <h5>Customer Service</h5>
          <p class="text-muted">Siap melayani 24/7</p>
        </div>
      </div>
    </div>
  </div>
</section>

</div>

{% endblock %}
