<div class="modal fade" id="testimonialModal" tabindex="-1" role="dialog" aria-labelledby="testimonialModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="testimonialModalLabel">Beri Penilaian</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <h6 class="mb-1">{{ order_item.product_name }}</h6>
          <small class="text-muted">Pesanan #{{ order.order_number }}</small>
        </div>
        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {% for error in form.non_field_errors %}
              <div>{{ error }}</div>
            {% endfor %}
          </div>
        {% endif %}
        <form
          hx-post="{% url 'core:submit_testimonial' order.order_number order_item.id %}"
          hx-target="#modal-container"
          hx-swap="innerHTML"
          hx-encoding="multipart/form-data"
          method="post"
          enctype="multipart/form-data"
        >
          {% csrf_token %}
          <div class="form-group text-center">
            <label class="font-weight-bold d-block mb-2">{{ form.fields.rating.label }}</label>
            <div class="star-rating d-inline-flex">
              {% with selected_str=form.rating.value|default_if_none:''|stringformat:'s' %}
                {% for value, label in form.fields.rating.choices reversed %}
                  {% with value_str=value|stringformat:'s' %}
                    <input type="radio" id="rating-{{ order_item.id }}-{{ value }}" name="rating" value="{{ value }}" {% if selected_str == value_str %}checked{% endif %}>
                    <label for="rating-{{ order_item.id }}-{{ value }}" title="{{ label }}"><i class="fas fa-star"></i></label>
                  {% endwith %}
                {% endfor %}
              {% endwith %}
            </div>
            {% if form.rating.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.rating.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          <div class="form-group">
            <label class="font-weight-bold">{{ form.fields.review.label }}</label>
            {{ form.review }}
            <small class="form-text text-muted">Komentar tidak wajib, tapi kami senang mendengar pengalaman Anda.</small>
            {% if form.review.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.review.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          <div class="form-group">
            <label class="font-weight-bold">{{ form.fields.photo.label }}</label>
            {{ form.photo }}
            <small class="form-text text-muted">Format gambar JPG atau PNG, maksimal 5MB.</small>
            {% if form.photo.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.photo.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Batal</button>
            <button type="submit" class="btn btn-success">Kirim Penilaian</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<style>
  .star-rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: center;
  }
  .star-rating input[type="radio"] {
    display: none;
  }
  .star-rating label {
    color: #ddd;
    font-size: 1.8rem;
    cursor: pointer;
    margin: 0 4px;
    transition: color 0.2s ease;
  }
  .star-rating input[type="radio"]:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: #ffc107;
  }
</style>
