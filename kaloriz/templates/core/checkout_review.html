{% extends 'base.html' %}

{% block title %}Review Pesanan - Kaloriz{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="checkout-steps mb-5">
    <div class="step completed">
      <div class="step-number">1</div>
      <div class="step-label">Alamat</div>
    </div>
    <div class="step-line"></div>
    <div class="step completed">
      <div class="step-number">2</div>
      <div class="step-label">Metode Pembayaran</div>
    </div>
    <div class="step-line"></div>
    <div class="step active">
      <div class="step-number">3</div>
      <div class="step-label">Review</div>
    </div>
  </div>

  <h2 class="mb-4">Review Pesanan</h2>

  <div class="alert alert-info">
    Ringkasan pesanan akan tampil lengkap di tahap selanjutnya.
  </div>

  <div class="row">
    <div class="col-lg-8 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">Produk Dipilih</h5>
        </div>
        <div class="card-body">
          {% if selected_items %}
            <ul class="list-unstyled mb-0">
              {% for item in selected_items %}
              <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                <span class="text-truncate mr-3">{{ item.product.name }} x{{ item.quantity }}</span>
                <span>Rp {{ item.get_subtotal|floatformat:0 }}</span>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">Belum ada produk yang dipilih.</p>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow checkout-summary-card sticky-top">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">Ringkasan Pembayaran</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-3">
            <span>Subtotal</span>
            <span class="font-weight-semibold">{{ subtotal_display }}</span>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <span>Ongkir</span>
            <span class="text-danger font-weight-semibold">{{ shipping_cost_display }}</span>
          </div>
          <div class="d-flex justify-content-between mb-3">
            <span>Metode Pengiriman</span>
            <span class="text-muted">{{ shipping_method_label }}</span>
          </div>
          {% if eta %}
          <div class="d-flex justify-content-between mb-3">
            <span>Estimasi Tiba</span>
            <span class="text-muted">{{ eta }}</span>
          </div>
          {% endif %}
          <div class="d-flex justify-content-between mb-3">
            <span>Metode Pembayaran</span>
            <span class="font-weight-semibold text-primary text-uppercase">{{ payment_method }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between align-items-center">
            <strong>Total</strong>
            <strong class="text-dark h5 mb-0">{{ total_display }}</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.checkout-steps {
  display: flex;
  align-items: center;
  justify-content: center;
}

.checkout-steps .step {
  text-align: center;
  position: relative;
}

.checkout-steps .step-number {
  width: 44px;
  height: 44px;
  line-height: 44px;
  border-radius: 50%;
  background: #f1f1f1;
  color: #6c757d;
  font-weight: 600;
  margin: 0 auto 8px;
}

.checkout-steps .step-label {
  font-size: 14px;
  color: #6c757d;
}

.checkout-steps .step-line {
  flex-grow: 1;
  height: 2px;
  background: #e0e0e0;
  margin: 0 15px;
}

.checkout-steps .step.completed .step-number {
  background: #28a745;
  color: #fff;
}

.checkout-steps .step.active .step-number {
  background: #343a40;
  color: #fff;
}

.checkout-summary-card.sticky-top {
  position: sticky;
  top: var(--checkout-summary-offset);
}

@media (max-width: 991px) {
  .checkout-summary-card.sticky-top {
    position: relative;
    top: auto;
  }
}
</style>

<script>
(function() {
  const rootElement = document.documentElement;

  function updateSummaryOffset() {
    if (!rootElement) {
      return;
    }
    const navbar = document.querySelector('.modern-navbar');
    const offset = navbar ? navbar.offsetHeight + 20 : 120;
    rootElement.style.setProperty('--checkout-summary-offset', `${offset}px`);
  }

  updateSummaryOffset();
  window.addEventListener('load', updateSummaryOffset);
  window.addEventListener('resize', updateSummaryOffset);
})();
</script>
{% endblock %}
